<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emploi du temps â€“ Master MLSD & AMSD</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <style>
    /* ====== Design system (futuriste + glass) ====== */
    :root {
      --bg: #0b0f18;
      --bg-2: #0f1422;
      --text: #e6e8ee;
      --muted: #aab2c8;
      --brand: #6ee7ff;            /* cyan light */
      --brand-2: #7c5cff;          /* violet */
      --card: rgba(255,255,255,.06);
      --card-border: rgba(255,255,255,.12);
      --glass: rgba(255,255,255,.08);
      --shadow: 0 10px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --blur: 10px;
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f9fc; --bg-2:#eef2fb; --text:#111319; --muted:#4b5568; 
        --card: rgba(0,0,0,.04); --card-border: rgba(0,0,0,.08); --glass: rgba(255,255,255,.75);
      }
    }

    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--text);
      background:
        radial-gradient(1200px 600px at -10% -10%, rgba(124,92,255,.25), transparent 60%),
        radial-gradient(900px 500px at 110% 10%, rgba(110,231,255,.18), transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 100%);
      min-height: 100vh; overflow-x: hidden;
    }

    a { color: inherit }

    .wrap {
      max-width: 1100px; margin: 0 auto; padding: 24px;
    }

    /* ====== Header ====== */
    header {
      position: sticky; top: 0; z-index: 50; backdrop-filter: blur(var(--blur));
      background: linear-gradient(0deg, transparent, rgba(0,0,0,.25));
      border-bottom: 1px solid var(--card-border);
    }
    .nav {
      display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 12px; padding: 14px 0;
    }
    .brand { display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.2px }
    .logo {
      width: 34px; height: 34px; border-radius: 10px; background:
        conic-gradient(from 210deg, var(--brand), var(--brand-2) 40%, var(--brand));
      box-shadow: 0 0 30px rgba(124,92,255,.35);
    }
    .links { display:flex; gap: 10px; justify-content:center; flex-wrap: wrap }
    .links a { text-decoration:none; padding: 8px 12px; border-radius: 10px; font-weight:600; color: var(--muted) }
    .links a.active, .links a:hover { color: var(--text); background: var(--card); border: 1px solid var(--card-border) }

    .actions { display:flex; gap:10px; justify-content:flex-end }
    .btn { border:1px solid var(--card-border); background: var(--glass); color: var(--text); padding:10px 14px; border-radius: 12px; cursor:pointer; font-weight:600; backdrop-filter: blur(var(--blur)); box-shadow: var(--shadow); transition: transform .15s ease, box-shadow .2s }
    .btn:hover { transform: translateY(-1px) }

    /* ====== Hero / Status ====== */
    .hero { display:grid; grid-template-columns: 1.2fr .8fr; gap: 18px; align-items: stretch; margin-top: 18px }
    @media (max-width: 900px){ .hero{ grid-template-columns: 1fr; } }

    .card { background: var(--card); border:1px solid var(--card-border); border-radius: var(--radius); padding: 18px; box-shadow: var(--shadow); position: relative; overflow: hidden }
    .card:before { content:""; position:absolute; inset: -1px; pointer-events:none; background:
      radial-gradient(400px 120px at 10% 0%, rgba(110,231,255,.12), transparent 60%),
      radial-gradient(300px 120px at 90% 0%, rgba(124,92,255,.12), transparent 60%);
      opacity:.9
    }

    .h1 { font-family: "Space Grotesk", Inter, sans-serif; font-size: clamp(22px, 3vw, 30px); margin: 4px 0 2px }
    .sub { color: var(--muted); margin: 0 0 14px }

    /* Upcoming pill */
    .pill { display:inline-flex; align-items:center; gap:8px; border:1px solid var(--card-border); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); padding:8px 12px; border-radius:999px; font-weight:600; margin-bottom:12px }
    .dot { width:9px; height:9px; border-radius:999px; background: linear-gradient(180deg, var(--brand), var(--brand-2)) }

    /* Calendar iframe container */
    .calendar-shell { border-radius: 14px; overflow: hidden; border:1px solid var(--card-border); background: rgba(0,0,0,.2) }
    iframe.cal { width:100%; height: 650px; border:0; display:block }
    @media (max-width: 768px){ iframe.cal { height: 520px } }

    /* Sidebar widgets */
    .widget { display:grid; gap: 12px }
    .row { display:flex; gap:10px; flex-wrap: wrap }
    .seg { flex:1 1 auto }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-weight:700; font-size:12px; letter-spacing:.2px; color: var(--muted) }

    .countdown { font-variant-numeric: tabular-nums; font-size: 28px; font-weight: 800 }

    .view-toggle { display:flex; gap:8px; flex-wrap: wrap }
    .chip { border:1px solid var(--card-border); background:var(--glass); padding:8px 12px; border-radius: 999px; cursor:pointer; font-weight:600; color: var(--muted) }
    .chip.active { color: var(--text); box-shadow: 0 0 0 2px rgba(110,231,255,.18) inset }

    /* Footer */
    footer { color: var(--muted); text-align:center; padding: 26px 0 }

    /* Subtle entrance animations */
    .reveal { opacity: 0; transform: translateY(8px); animation: up .5s ease forwards }
    .reveal.d2 { animation-delay: .1s }
    .reveal.d3 { animation-delay: .2s }

    @keyframes up { to { opacity: 1; transform: translateY(0) } }
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand"><div class="logo" aria-hidden="true"></div><div>Master <span style="color:var(--brand)">MLSD</span> & <span style="color:var(--brand-2)">AMSD</span></div></div>
      <nav class="links" aria-label="Navigation principale">
        <a href="#planning" class="active" data-section="planning">Planning</a>
        <a href="#calendar" data-section="calendar">Calendrier (image)</a>
        <a href="#mlsd" data-section="mlsd">MLSD</a>
        <a href="#amsd" data-section="amsd">AMSD</a>
        <a href="#terms" data-section="terms">Termes</a>
        <a href="#plan" data-section="plan">Plan</a>
      </nav>
      <div class="actions">
        <a class="btn" href="https://intranet.u-paris.fr/" target="_blank" rel="noopener">Intranet</a>
        <a class="btn" href="https://moodle.u-paris.fr/" target="_blank" rel="noopener">Moodle</a>
        <button class="btn" id="themeToggle" aria-label="Basculer le thÃ¨me">ðŸŒ“</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- ===== PLANNING (Google Calendar) ===== -->
    <section id="planning" class="reveal">
      <div class="card">
        <div class="pill"><span class="dot"></span> Prochain cours <span id="nextTitle" style="margin-left:6px; font-weight:800"></span></div>
        <h1 class="h1">Emploi du temps â€“ Semaine en cours</h1>
        <p class="sub">Vue native Google Agenda (Europe/Paris). Choisis la vue, et avance/recul d'une semaine.</p>

        <div class="widget">
          <div class="row">
            <div class="seg">
              <div class="view-toggle" role="tablist" aria-label="Type de vue">
                <button class="chip active" data-mode="WEEK" role="tab" aria-selected="true">Semaine</button>
                <button class="chip" data-mode="AGENDA" role="tab" aria-selected="false">Agenda</button>
                <button class="chip" data-mode="MONTH" role="tab" aria-selected="false">Mois</button>
              </div>
            </div>
            <div class="seg" style="text-align:right">
              <button class="btn" id="prevWeek" title="Semaine prÃ©cÃ©dente">â—€</button>
              <button class="btn" id="today" title="Aujourd'hui">Aujourd'hui</button>
              <button class="btn" id="nextWeek" title="Semaine suivante">â–¶</button>
            </div>
          </div>
          <div class="row">
            <div class="seg kbd">TimezoneÂ : Europe/Paris</div>
            <div class="seg" style="text-align:right"><span class="kbd">DÃ©but du prochain cours dans</span> <span class="countdown" id="countdown">â€”</span></div>
          </div>
          <div class="calendar-shell reveal d2">
            <iframe id="gcal" class="cal" title="Google Calendar embedded"></iframe>
          </div>
          <p class="sub">Si le calendrier ne s'affiche pas correctement, <a href="https://docs.google.com/spreadsheets/d/1IhyeM39QryPrYvrWcEFiChPrkVHD4Sw3/edit?gid=51203610#gid=51203610" target="_blank" rel="noopener">consulte la version de secours</a>.</p>
        </div>
      </div>
    </section>

    <!-- ===== CALENDRIER IMAGE ===== -->
    <section id="calendar" class="reveal d2" hidden>
      <div class="card">
        <h2 class="h1">Calendrier de formation 2024â€“2025</h2>
        <img src="calendrier2024.png" alt="Calendrier MLSD & AMSD" style="width:100%; border-radius:14px; border:1px solid var(--card-border)"/>
        <p class="sub">Valable pour MLSD et AMSD (2024â€“2025).</p>
      </div>
    </section>

    <!-- ===== MLSD / AMSD / TERMS / PLAN (placeholders Ã  relier) ===== -->
    <section id="mlsd" class="reveal d2" hidden>
      <div class="card"><h2 class="h1">PrÃ©sentation MLSD</h2><p class="sub">Relie ici ton contenu MLSD existant.</p></div>
    </section>
    <section id="amsd" class="reveal d2" hidden>
      <div class="card"><h2 class="h1">PrÃ©sentation AMSD</h2><p class="sub">Relie ici ton contenu AMSD existant.</p></div>
    </section>
    <section id="terms" class="reveal d2" hidden>
      <div class="card"><h2 class="h1">Termes statistiques essentiels</h2><p class="sub">Relie ici ta section de dÃ©finitions.</p></div>
    </section>
    <section id="plan" class="reveal d2" hidden>
      <div class="card"><h2 class="h1">Plan du bÃ¢timent principal</h2><img src="Plan_salles.jpg" alt="Plan du bÃ¢timent principal" style="width:100%; border-radius:14px; border:1px solid var(--card-border)"></div>
    </section>

    <footer class="reveal d3">Â© SINGH 2024 â€“ 2025 â€¢ UniversitÃ© Paris CitÃ©</footer>
  </main>

  <script>
    // ===== Router de sections (sans rechargement)
    const links = document.querySelectorAll('.links a');
    const sections = document.querySelectorAll('main section');
    links.forEach(a=>{
      a.addEventListener('click', (e)=>{
        e.preventDefault();
        links.forEach(l=>l.classList.toggle('active', l===a));
        sections.forEach(s=> s.hidden = (s.id !== a.dataset.section));
        history.replaceState({}, '', `#${a.dataset.section}`);
      })
    })
    // Ouvrir la bonne section si un hash est prÃ©sent
    const initial = location.hash.replace('#','') || 'planning';
    document.querySelector(`.links a[data-section="${initial}"]`)?.click();

    // ===== ThÃ¨me (persistance)
    const themeToggle = document.getElementById('themeToggle');
    const setTheme = t => {
      document.documentElement.dataset.theme = t; // placeholder si tu veux des variantes
      localStorage.setItem('themePref', t);
    };
    if(localStorage.getItem('themePref')) setTheme(localStorage.getItem('themePref'));
    themeToggle.addEventListener('click', ()=>{
      const current = localStorage.getItem('themePref') === 'light' ? 'dark' : 'light';
      setTheme(current);
      // petit feedback
      themeToggle.animate([{transform:'scale(1)'},{transform:'scale(1.08)'},{transform:'scale(1)'}],{duration:180});
    });

    // ===== Google Calendar embed â€“ contrÃ´les dynamiques
    const iframe = document.getElementById('gcal');
    const chips = document.querySelectorAll('.chip');
    const prevBtn = document.getElementById('prevWeek');
    const todayBtn = document.getElementById('today');
    const nextBtn = document.getElementById('nextWeek');

    // Ton calendrier + couleurs (reprend ton code)
    const baseParams = new URLSearchParams({
      height: 650,
      wkst: 2,
      ctz: 'Europe/Paris',
      bgcolor: '#0b0f18',
      title: 'M1 MLSD-AMSD 2024-2025',
      showTabs: 0,
      showCalendars: 0,
      mode: 'WEEK',
      src: [
        'NmJlZmY2NWFkYTA2NjE4NDZmNzc0NDY3YzVjYjU4MTg5ZDBmZGMxYjM2NDAxY2NjNDdiZWFjODhiMDk5NDg2N0Bncm91cC5jYWxlbmRhci5nb29nbGUuY29t',
        'ZnIuZnJlbmNoI2hvbGlkYXlAZ3JvdXAudi5jYWxlbmRhci5nb29nbGUuY29t'
      ],
      color: ['#F6BF26','#4285F4']
    });

    let weekOffset = 0; // 0 = semaine actuelle

    function startOfWeek(d){
      const x = new Date(d); const day = (x.getDay()+6)%7; // lundi=0
      x.setHours(0,0,0,0); x.setDate(x.getDate()-day); return x;
    }

    function formatISODate(d){
      return d.toISOString().split('T')[0];
    }

    function updateCalendar(){
      const mode = baseParams.get('mode');
      const params = new URLSearchParams(baseParams.toString());

      if(mode === 'WEEK' || mode === 'AGENDA'){
        const base = startOfWeek(new Date());
        base.setDate(base.getDate() + weekOffset*7);
        params.set('dates', `${formatISODate(base)}/${formatISODate(new Date(base.getFullYear(), base.getMonth(), base.getDate()+7))}`);
      } else {
        params.delete('dates');
      }
      const url = `https://calendar.google.com/calendar/embed?${params.toString()}`;
      iframe.src = url;
    }

    chips.forEach(c=> c.addEventListener('click', ()=>{
      chips.forEach(x=>x.classList.toggle('active', x===c));
      baseParams.set('mode', c.dataset.mode);
      weekOffset = 0; // reset
      updateCalendar();
    }));

    prevBtn.addEventListener('click', ()=>{ weekOffset--; updateCalendar(); });
    todayBtn.addEventListener('click', ()=>{ weekOffset = 0; updateCalendar(); });
    nextBtn.addEventListener('click', ()=>{ weekOffset++; updateCalendar(); });

    updateCalendar();

    // ===== Compte Ã  rebours (prochain crÃ©neau)
    const nextTitle = document.getElementById('nextTitle');
    const countdownEl = document.getElementById('countdown');

    // Option 1: lire un flux ICS PUBLIC (si CORS ok) â†’ mets l'URL ICS publique de ton agenda ci-dessous
    const ICS_URL = '';

    async function getNextEventFromICS(){
      if(!ICS_URL) return null;
      try{
        const res = await fetch(ICS_URL);
        if(!res.ok) throw new Error('HTTP '+res.status);
        const ics = await res.text();
        // parsing ultra lÃ©ger
        const events = [];
        const blocks = ics.split('BEGIN:VEVENT').slice(1);
        for(const b of blocks){
          const dtstart = /DTSTART(?:;[^:]+)?:([^\n\r]+)/.exec(b)?.[1];
          const dtend = /DTEND(?:;[^:]+)?:([^\n\r]+)/.exec(b)?.[1];
          const sum = /SUMMARY:([^\n\r]+)/.exec(b)?.[1];
          if(!dtstart||!dtend) continue;
          const parse = (s)=>{
            // gcal ICS: UTC ou local; on traite basiquement ici
            if(/Z$/.test(s)) return new Date(s);
            // YYYYMMDDTHHMMSS
            const y=s.slice(0,4), m=s.slice(4,6), d=s.slice(6,8), H=s.slice(9,11)||'00', M=s.slice(11,13)||'00', S=s.slice(13,15)||'00';
            return new Date(`${y}-${m}-${d}T${H}:${M}:${S}+02:00`); // Europe/Paris approx
          };
          const start=parse(dtstart), end=parse(dtend);
          if(end > new Date()) events.push({start, end, title: sum||'Cours'});
        }
        events.sort((a,b)=> a.start - b.start);
        return events[0]||null;
      }catch(e){
        console.warn('ICS read failed', e);
        return null;
      }
    }

    function runCountdown(date){
      function tick(){
        const now = new Date();
        const diff = date - now;
        if(diff <= 0){ countdownEl.textContent = 'en cours / maintenant'; return; }
        const h = Math.floor(diff/3.6e6), m = Math.floor((diff%3.6e6)/6e4), s = Math.floor((diff%6e4)/1e3);
        countdownEl.textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        requestAnimationFrame(()=> setTimeout(tick, 250));
      }
      tick();
    }

    (async ()=>{
      const ev = await getNextEventFromICS();
      if(ev){
        nextTitle.textContent = `â€¢ ${ev.title} â€“ ${ev.start.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'})}`;
        runCountdown(ev.start);
      } else {
        nextTitle.textContent = "â€¢ synchronisÃ© avec Google Agenda";
        countdownEl.textContent = 'â€”';
      }
    })();
  </script>
</body>
</html>
